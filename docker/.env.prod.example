# Production Environment Variables
# Copy this file to .env and update with your actual values
# IMPORTANT: Change all default values before deploying to production!

# =============================================================================
# CORE APPLICATION SETTINGS
# =============================================================================

# Domain and URL Configuration (REQUIRED)
DOMAIN=your-domain.com
NUXT_PUBLIC_DOMAIN=your-domain.com
NUXT_PUBLIC_USE_HTTPS=true
NUXT_PUBLIC_API_BASE=https://your-domain.com

# Environment
NODE_ENV=production
RUST_LOG=info,tinyboards_api=info,tinyboards_db=warn
RUST_BACKTRACE=1
ENVIRONMENT=production

# =============================================================================
# DATABASE CONFIGURATION (REQUIRED)
# =============================================================================

# PostgreSQL Connection
POSTGRES_USER=tinyboards
POSTGRES_PASSWORD=your_very_secure_database_password_here_change_this
POSTGRES_DB=tinyboards
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# Database URL (auto-generated, don't modify unless needed)
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# Database Replication (Optional)
POSTGRES_REPLICATION_USER=replicator
POSTGRES_REPLICATION_PASSWORD=your_replication_password_here

# Database Performance (Production Optimized)
POSTGRES_MAX_CONNECTIONS=200
POSTGRES_SHARED_BUFFERS=1GB
POSTGRES_EFFECTIVE_CACHE_SIZE=3GB
POSTGRES_WORK_MEM=8MB
POSTGRES_MAINTENANCE_WORK_MEM=256MB

# =============================================================================
# SECURITY SETTINGS (CRITICAL)
# =============================================================================

# JWT and Encryption (CHANGE THESE!)
SALT_SUFFIX=your_unique_salt_here_must_be_random
JWT_SECRET=your_very_long_jwt_secret_at_least_64_chars_change_this_value

# Admin Account (Change after first setup)
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your_very_secure_admin_password_here_minimum_20_chars
ADMIN_EMAIL=admin@your-domain.com

# Security Headers
SECURITY_HEADERS_ENABLED=true
HSTS_MAX_AGE=31536000
CSP_ENABLED=true

# =============================================================================
# SSL/TLS CONFIGURATION
# =============================================================================

# SSL Settings
TLS_ENABLED=true
SSL_REDIRECT=true

# Let's Encrypt Configuration
LETSENCRYPT_EMAIL=admin@your-domain.com
LETSENCRYPT_STAGING=false

# SSL Certificate Paths (if using custom certificates)
SSL_CERTIFICATE_PATH=/etc/letsencrypt/live/${DOMAIN}/fullchain.pem
SSL_CERTIFICATE_KEY_PATH=/etc/letsencrypt/live/${DOMAIN}/privkey.pem

# =============================================================================
# EMAIL CONFIGURATION
# =============================================================================

# SMTP Settings (Configure for your email provider)
SMTP_SERVER=smtp.your-provider.com:587
SMTP_LOGIN=noreply@your-domain.com
SMTP_PASSWORD=your_email_password_here
SMTP_FROM_ADDRESS=noreply@your-domain.com
TLS_TYPE=starttls

# Email Templates
EMAIL_TEMPLATES_PATH=/app/templates/email

# =============================================================================
# MEDIA AND UPLOADS
# =============================================================================

# Media Storage
MEDIA_PATH=/app/media
MAX_FILE_SIZE_MB=50

# Upload Security
ALLOWED_FILE_TYPES=jpg,jpeg,png,gif,webp,mp4,webm
SCAN_UPLOADS=true

# CDN Configuration (Optional)
CDN_ENABLED=false
CDN_URL=https://cdn.your-domain.com
CDN_ACCESS_KEY=your_cdn_access_key
CDN_SECRET_KEY=your_cdn_secret_key

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# Redis Connection
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_here
REDIS_DB=0

# Redis Performance
REDIS_MAX_MEMORY=512mb
REDIS_MAX_MEMORY_POLICY=allkeys-lru
REDIS_SAVE_ENABLED=true

# Redis Clustering (if using Redis Cluster)
REDIS_CLUSTER_ENABLED=false
REDIS_CLUSTER_NODES=redis-1:6379,redis-2:6379,redis-3:6379

# =============================================================================
# RATE LIMITING (Production Values)
# =============================================================================

# API Rate Limits (per minute)
RATE_LIMIT_MESSAGE=180
RATE_LIMIT_POST=6
RATE_LIMIT_REGISTER=3
RATE_LIMIT_IMAGE=6
RATE_LIMIT_COMMENT=6
RATE_LIMIT_SEARCH=60

# Connection Limits
MAX_CONNECTIONS_PER_IP=20
MAX_REQUESTS_PER_CONNECTION=1000

# =============================================================================
# SITE CONFIGURATION
# =============================================================================

# Site Information
SITE_NAME=Your TinyBoards Instance
SITE_DESCRIPTION=A federated link aggregator and forum
SITE_ICON=https://your-domain.com/icon.png
SITE_BANNER=https://your-domain.com/banner.png

# Default Board Configuration
DEFAULT_BOARD_NAME=general
DEFAULT_BOARD_DESCRIPTION=General discussion and community topics

# Features
CAPTCHA_ENABLED=true
CAPTCHA_DIFFICULTY=medium
REGISTRATION_OPEN=true
FEDERATION_ENABLED=false

# =============================================================================
# PERFORMANCE AND SCALING
# =============================================================================

# Backend Performance
TOKIO_WORKER_THREADS=4
TOKIO_BLOCKING_THREADS=4
RUST_SECURE_ZERO_MEMORY=1

# Frontend Performance
NODE_OPTIONS=--max-old-space-size=1024
UV_THREADPOOL_SIZE=4

# Database Connection Pooling
DB_POOL_SIZE=20
DB_POOL_TIMEOUT=30

# =============================================================================
# MONITORING AND LOGGING
# =============================================================================

# Logging Configuration
LOG_LEVEL=info
LOG_FORMAT=json
LOG_FILE_ENABLED=true
LOG_ROTATION_ENABLED=true
LOG_MAX_SIZE=100M
LOG_MAX_FILES=10

# Metrics and Monitoring
METRICS_ENABLED=true
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# Health Checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30s

# Error Tracking (Optional)
SENTRY_ENABLED=false
SENTRY_DSN=your_sentry_dsn_here

# =============================================================================
# BACKUP AND DISASTER RECOVERY
# =============================================================================

# Database Backups
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_COMPRESSION=true

# Backup Storage
BACKUP_STORAGE_TYPE=local
BACKUP_STORAGE_PATH=/opt/backups
# For S3 backups:
# BACKUP_STORAGE_TYPE=s3
# BACKUP_S3_BUCKET=your-backup-bucket
# BACKUP_S3_ACCESS_KEY=your_s3_access_key
# BACKUP_S3_SECRET_KEY=your_s3_secret_key

# =============================================================================
# THIRD-PARTY INTEGRATIONS
# =============================================================================

# Analytics (Optional)
ANALYTICS_ENABLED=false
GOOGLE_ANALYTICS_ID=GA-XXXXXXXXX-X

# Search Engine (Optional)
SEARCH_ENGINE=postgresql  # Options: postgresql, elasticsearch
ELASTICSEARCH_URL=http://elasticsearch:9200

# Object Storage (Optional)
OBJECT_STORAGE_ENABLED=false
S3_BUCKET=your-bucket-name
S3_ACCESS_KEY=your_s3_access_key
S3_SECRET_KEY=your_s3_secret_key
S3_REGION=us-east-1

# =============================================================================
# NOTIFICATION SERVICES
# =============================================================================

# Slack Notifications (Optional)
SLACK_ENABLED=false
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK

# Discord Notifications (Optional)
DISCORD_ENABLED=false
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR/DISCORD/WEBHOOK

# =============================================================================
# DOCKER AND INFRASTRUCTURE
# =============================================================================

# Image Configuration
TINYBOARDS_IMAGE=kronusdev/tinyboards-be:latest
TINYBOARDS_FE_IMAGE=kronusdev/tinyboards-fe:latest

# Container Resources
BACKEND_MEMORY_LIMIT=2G
BACKEND_CPU_LIMIT=2.0
FRONTEND_MEMORY_LIMIT=1G
FRONTEND_CPU_LIMIT=1.5
POSTGRES_MEMORY_LIMIT=4G
POSTGRES_CPU_LIMIT=3.0

# Network Configuration
NETWORK_NAME=tinyboards_prod_network
NETWORK_SUBNET=172.20.0.0/16

# Volume Configuration
VOLUME_PREFIX=tinyboards_prod
POSTGRES_DATA_PATH=/opt/tinyboards/postgres
MEDIA_DATA_PATH=/opt/tinyboards/media
REDIS_DATA_PATH=/opt/tinyboards/redis

# =============================================================================
# SECURITY SCANNING AND UPDATES
# =============================================================================

# Watchtower for Automatic Updates
WATCHTOWER_ENABLED=false
WATCHTOWER_SCHEDULE=0 2 * * 0  # Weekly on Sunday at 2 AM
WATCHTOWER_CLEANUP=true

# Security Scanning
SECURITY_SCAN_ENABLED=false
TRIVY_ENABLED=false

# =============================================================================
# COMPLIANCE AND LEGAL
# =============================================================================

# GDPR Compliance
GDPR_COMPLIANCE_ENABLED=true
DATA_RETENTION_DAYS=2555  # 7 years
PRIVACY_POLICY_URL=https://your-domain.com/privacy
TERMS_OF_SERVICE_URL=https://your-domain.com/terms

# Content Moderation
CONTENT_MODERATION_ENABLED=true
AUTO_MODERATION_ENABLED=false

# =============================================================================
# FEDERATION (ActivityPub)
# =============================================================================

# Federation Settings
FEDERATION_ENABLED=false
FEDERATION_DEBUG=false
ACTIVITYPUB_ENABLED=false

# Federation Security
FEDERATION_WORKER_COUNT=1
FEDERATION_HTTP_TIMEOUT=10
FEDERATION_QUEUE_SIZE=1000

# =============================================================================
# IMPORTANT SECURITY NOTES
# =============================================================================

# 1. Change ALL passwords and secrets before deploying
# 2. Use environment-specific values, never copy from examples
# 3. Regularly rotate passwords and API keys
# 4. Enable fail2ban or similar intrusion prevention
# 5. Use strong, unique passwords (minimum 20 characters)
# 6. Enable 2FA for admin accounts
# 7. Regularly update dependencies and containers
# 8. Monitor logs for suspicious activity
# 9. Implement proper backup and disaster recovery
# 10. Review and test security configurations regularly

# =============================================================================
# COMPOSE CONFIGURATION
# =============================================================================

COMPOSE_PROJECT_NAME=tinyboards_prod
COMPOSE_FILE=docker-compose.prod.yml